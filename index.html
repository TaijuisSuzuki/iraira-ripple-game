<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>Iraira Ripple Game – Global Ranking Edition</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<style>
html,body{
  margin:0;
  height:100%;
  background:#5F249F;
  background:radial-gradient(circle at 25% 30%,#7B3DFF 0%,#5F249F 40%,#3B0E6B 100%);
  color:#fff;
  font-family:sans-serif;
}
body::before{
  content:"";position:fixed;inset:0;pointer-events:none;z-index:-1;
  background:repeating-linear-gradient(135deg,rgba(255,255,255,.04) 0 2px,transparent 2px 10px);
  animation:bgSlide 25s linear infinite;
}
@keyframes bgSlide{0%{transform:translateX(0)}100%{transform:translateX(200px)}}
canvas{display:block;position:fixed;inset:0;width:100%;height:100%;z-index:0;}
#ui{position:fixed;top:6px;left:50%;transform:translateX(-50%);font-size:20px;pointer-events:none;z-index:5}
#meterWrap{position:fixed;top:36px;left:50%;transform:translateX(-50%);width:80%;max-width:560px;height:12px;background:rgba(255,255,255,.25);border-radius:6px;z-index:5}
#meterBar{height:100%;width:0;background:#ff3333;border-radius:6px;transition:width .1s linear}
.screen{
  position:relative;
  min-height:100vh;
  width:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  background:rgba(0,0,0,.70);
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
  animation:fade .4s forwards;
  z-index:20;
  box-sizing:border-box;
  padding-bottom:40px;
}
@keyframes fade{from{opacity:0}to{opacity:1}}
.screen h1{font-size:64px;margin:8vh 0 20px;text-align:center}
.btn{font-size:28px;padding:12px 48px;border:none;border-radius:8px;background:#ff005d;color:#fff;cursor:pointer;transition:background .2s}
.btn:hover{background:#ff3380}
table{border-collapse:collapse;color:#fff;margin-top:12px}
td,th{padding:4px 10px;border-bottom:1px solid #444;text-align:center}
.meeting{font-size:24px;margin:4px 0 24px;color:#ffcc00}
.char-list{display:flex;flex-wrap:wrap;justify-content:center;gap:36px;max-width:760px;margin-bottom:28px}
.char{width:130px;text-align:center}
.char img{width:96px;height:96px;object-fit:cover;border-radius:50%;border:2px solid #fff}
.char-name{font-weight:bold;margin-top:6px;font-size:16px}
.char-desc{font-size:13px;line-height:1.4}
#nameWrap{display:flex;flex-direction:column;align-items:center;margin-top:20px}
#userName{font-size:22px;padding:6px 10px;border-radius:6px;border:none;width:220px;text-align:center}
#diffWrap{margin:18px 0;font-size:20px}
#topRankingWrap{
  width:100%;max-width:600px;margin:24px auto 0;
  background:rgba(0,0,0,0.3);border-radius:10px;padding:10px 0;
  box-sizing:border-box;
}
#topRankingTitle{font-size:22px;text-align:center;margin:0 0 8px 0;}
#topRankingTableWrap{
  max-height:400px;overflow-y:auto;width:100%;
}
#topRankingTable{width:100%;}
/* PC用2カラムレイアウト */
#charAndRankWrap {
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: flex-start;
  width: 100%;
  max-width: 1280px;
  margin: 0 auto;
  gap: 48px;
}
#charIntroCol {
  flex: 1 1 0;
  min-width: 340px;
  max-width: 520px;
  display: flex;
  flex-direction: column;
  align-items: center;
}
#rankCol {
  flex: 1 1 0;
  min-width: 340px;
  max-width: 600px;
  display: flex;
  flex-direction: column;
  align-items: center;
}
#rankCol #topRankingWrap {
  margin: 0 0 24px 0;
}
#rankCol #nameWrap,
#rankCol #diffWrap,
#rankCol #toRuleBtn,
#rankCol #snsShareWrap {
  width: 100%;
  max-width: 400px;
  margin-left: auto;
  margin-right: auto;
}
#snsShareWrap {
  display: flex;
  justify-content: center;
  gap: 16px;
  margin-top: 18px;
}
.sns-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  border: none;
  border-radius: 6px;
  padding: 8px 18px;
  background: #fff;
  color: #5F249F;
  cursor: pointer;
  transition: background .2s;
  text-decoration: none;
  font-weight: bold;
}
.sns-btn:hover { background: #ffccf5; color: #5F249F; }
.sns-btn img { width: 22px; height: 22px; margin-right: 6px; }
@media(max-width: 640px){
  .screen h1{font-size:48px}
  table{font-size:14px}
  .btn{font-size:24px;padding:10px 36px}
  #ui{font-size:18px}
  #topRankingWrap{max-width:98%;}
  #charAndRankWrap {
    flex-direction: column;
    gap: 0;
    max-width: 100%;
  }
  #charIntroCol, #rankCol {
    min-width: 0;
    max-width: 100%;
    width: 100%;
  }
  #rankCol #topRankingWrap,
  #rankCol #nameWrap,
  #rankCol #diffWrap,
  #rankCol #toRuleBtn,
  #rankCol #snsShareWrap {
    max-width: 98%;
  }
}
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="ui" style="display:none">Loading…</div>
<div id="meterWrap" style="display:none"><div id="meterBar"></div></div>
<div id="charScreen" class="screen">
  <h1>CHARACTER INTRODUCTION</h1>
  <div id="charAndRankWrap">
    <!-- 左カラム：キャラクター紹介 -->
    <div id="charIntroCol">
      <div class="char-list">
        <div class="char"><img src="img/player.png"><div class="char-name">You</div><div class="char-desc">マウス / 指で操作</div></div>
        <div class="char"><img src="img/ishibesawa.png"><div class="char-name">石部砂羽</div><div class="char-desc">オーラに触れると大家くん召喚</div></div>
        <div class="char"><img src="img/ohyakaisei.png"><div class="char-name">大家くん</div><div class="char-desc">接触で ❤ −1</div></div>
        <div class="char"><img src="img/cigarette.png"><div class="char-name">タバコ</div><div class="char-desc">オーラ半減 +200pt</div></div>
        <div class="char"><img src="img/beer.png"><div class="char-name">ビール</div><div class="char-desc">オーラ半減 +200pt</div></div>
        <div class="char"><img src="img/tenga.png"><div class="char-name">テンガ</div><div class="char-desc">オーラ0% +500pt</div></div>
      </div>
    </div>
    <!-- 右カラム：ランキング＋名前入力＋スタート＋SNS -->
    <div id="rankCol">
      <div id="topRankingWrap">
        <div id="topRankingTitle">GLOBAL RANKING</div>
        <div id="topRankingTableWrap">
          <table id="topRankingTable">
            <thead>
              <tr><th>RANK</th><th>NAME</th><th>SCORE</th><th>DATE</th></tr>
            </thead>
            <tbody id="topRankingBody">
              <tr><td colspan="4">Loading...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
      <div id="nameWrap">
        <input id="userName" type="text" placeholder="Your name" maxlength="16">
        <small style="margin-top:6px;font-size:14px;color:#ccc">※16文字以内・未入力なら Anonymous</small>
      </div>
      <div id="diffWrap">
        DIFFICULTY:
        <label style="margin:0 10px"><input type="radio" name="diff" value="EASY">EASY</label>
        <label style="margin:0 10px"><input type="radio" name="diff" value="NORMAL" checked>NORMAL</label>
        <label style="margin:0 10px"><input type="radio" name="diff" value="HARD">HARD</label>
      </div>
      <button id="toRuleBtn" class="btn">NEXT</button>
      <div id="snsShareWrap">
        <a class="sns-btn" id="twitterShare" href="#" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/x.svg" alt="X(Twitter)">X</a>
        <a class="sns-btn" id="lineShare" href="#" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/line.svg" alt="LINE">LINE</a>
        <a class="sns-btn" id="fbShare" href="#" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/facebook.svg" alt="Facebook">Facebook</a>
      </div>
    </div>
  </div>
</div>
<div id="ruleScreen" class="screen" style="display:none">
  <h1>HOW TO PLAY</h1>
  <p style="max-width:640px;font-size:18px;line-height:1.5;margin:0 20px 36px;text-align:left">
    ● プレイヤーをマウス / 指で操作。<br>
    ● オーラは時間とともに拡大し、石部砂羽が触れると大家くんが増える。<br>
    ● タバコ / ビール：オーラ半減＋200pt。<br>
    ● テンガ：オーラ 0% ＋500pt。<br>
    ● 1秒ごと +10pt、20秒ごとに LvUP（石部砂羽のみ加速）。<br>
    ● 難易度で大家くん上限・アイテム確率が変化。Enjoy!
  </p>
  <button id="startBtn" class="btn">START</button>
</div>
<div id="overlay" class="screen" style="display:none">
  <h1>GAME OVER</h1>
  <p id="finalScore"></p>
  <p id="yourRank" style="font-size:22px;margin:6px 0 18px"></p>
  <p id="meetingMsg" class="meeting"></p>
  <div id="specialLink" style="margin:16px 0; display:none;"></div>
  <div id="cloudMsg" style="margin:16px 0; display:none; color:#ffcc00; font-size:20px;"></div>
  <h2>GLOBAL RANKING TOP 5</h2>
  <table>
    <thead><tr><th>RANK</th><th>NAME</th><th>SCORE</th><th>DATE</th></tr></thead>
    <tbody id="rankBody"></tbody>
  </table>
  <button id="retry" class="btn" style="margin-top:24px">Retry</button>
  <button id="topBtn" class="btn" style="margin-top:12px">TOP</button>
</div>
<audio id="bgm"    src="audio/327_BPM110.mp3"         preload="auto" loop></audio>
<audio id="btnSE"  src="audio/botton.mp3"              preload="auto"></audio>
<audio id="itemSE" src="audio/coin-pickup-98269.mp3"   preload="auto"></audio>
<script type="module">
// ...（ここから下は元のJSコードをそのまま全文貼り付けてください。省略不可です）...
// 省略せず、質問文の<script type="module">～</script>の内容をそのまま貼り付けてください。
// SNSシェア用のJSを追加
const shareUrl = encodeURIComponent(location.href);
const shareText = encodeURIComponent("Iraira Ripple Gameで遊ぼう！グローバルランキングに挑戦しよう！");
document.getElementById('twitterShare').href = `https://twitter.com/intent/tweet?text=${shareText}&url=${shareUrl}`;
document.getElementById('lineShare').href = `https://social-plugins.line.me/lineit/share?url=${shareUrl}`;
document.getElementById('fbShare').href = `https://www.facebook.com/sharer/sharer.php?u=${shareUrl}`;
</script>
<script nomodule>
document.body.innerHTML='<div style="color:#fff;padding:30px;font-size:20px;line-height:1.6">このブラウザは ES Modules に対応していません。最新版の Chrome / Safari / Edge / Firefox などでご利用ください。</div>';
</script>
</body>
</html>
